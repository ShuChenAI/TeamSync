graph TB
    subgraph ClientTier["ğŸ‘¥ å®¢æˆ¶ç«¯å±¤"]
        direction LR
        WebApp["ğŸŒ Web App<br/>Jitsi IFrame"]
        WebAudio["ğŸ¤ Web Audio API"]
    end

    subgraph GatewayTier["ğŸšª API é–˜é“å±¤"]
        direction LR
        FastAPI["ğŸ“¹ FastAPI:8888"]
        WSServer["ğŸ™ï¸ WebSocket Server"]
    end

    subgraph VideoTier["ğŸ“¹ è¦–è¨Šæœå‹™å±¤"]
        direction LR
        JitsiWeb["ğŸŒ Jitsi Web:443"]
        Prosody["ğŸ’¬ Prosody:5222"]
        Jicofo["ğŸ¯ Jicofo:8888"]
        JVB["ğŸ¥ JVB:10000"]

        JitsiWeb -.-> Prosody
        Jicofo -.-> Prosody
        JVB -.-> Jicofo
    end

    subgraph CloudTier["â˜ï¸ é›²ç«¯æœå‹™å±¤"]
        direction LR
        AWS["ğŸŒ AWS Transcribe"]
    end

    subgraph ProcessingTier["âš™ï¸ è™•ç†å±¤"]
        direction LR
        subgraph AICore["ğŸ¤– AI æ ¸å¿ƒ"]
            AIEngine["ğŸ¤– LangChain"]
            Qdrant[("ğŸ” Qdrant")]
            Redis[("ğŸ’¾ Redis")]

            AIEngine <--> Qdrant
            AIEngine <--> Redis
        end

        subgraph Translation["ğŸŒ ç¿»è­¯æœå‹™"]
            TransSvc["ğŸŒ Translator"]
            Google["Google API"]
            DeepL["DeepL API"]

            TransSvc --> Google
            TransSvc -.-> DeepL
        end
    end

    subgraph MessageTier["ğŸ“¡ è¨Šæ¯å±¤"]
        MQTT["ğŸ“¡ Mosquitto MQTT"]
    end

    %% Main flow connections
    WebApp -->|1.è«‹æ±‚æœƒè­°| FastAPI
    FastAPI -->|2.JWT| JitsiWeb
    WebApp -->|3.WebRTC| JVB

    WebAudio -->|4.éŸ³è¨Š| WSServer
    WSServer -->|5.ç°½åURL| AWS
    AWS -->|6.è½‰éŒ„| WSServer

    WSServer -->|7.åŸæ–‡| AIEngine
    AIEngine -->|8.ä¿®æ­£æ–‡| TransSvc
    TransSvc -->|9.ç™¼å¸ƒ| MQTT
    MQTT -->|10.è¨‚é–±| WebApp

    classDef client fill:#ffcccc,stroke:#ff6666,stroke-width:2px
    classDef gateway fill:#ccffcc,stroke:#66cc66,stroke-width:2px
    classDef video fill:#ffd9b3,stroke:#ff8800,stroke-width:2px
    classDef cloud fill:#e6f3ff,stroke:#0066cc,stroke-width:2px
    classDef ai fill:#ccccff,stroke:#6666ff,stroke-width:2px
    classDef message fill:#fff2cc,stroke:#d6b656,stroke-width:2px

    class WebApp,WebAudio client
    class FastAPI,WSServer gateway
    class JitsiWeb,Jicofo,JVB,Prosody video
    class AWS cloud
    class AIEngine,Qdrant,Redis,TransSvc,Google,DeepL ai
    class MQTT message 